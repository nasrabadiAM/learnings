View
---

گاهی اوقات یک کاستوم‌ویو می‌خواهیم که مشابه آن در اندروید وجود نداشته و حتی با ابزارهای عادی اندروید نمی توانیم آن را بسازیم. در اینجا از کاستوم‌ویو استفاده می‌کنیم. در حالت دیگر زمانی از کاستوم ویو استفاده می‌کنیم که پرفورمنس ویو‌ها خیلی برای ما مهم باشد و داشتن هایراکی در ویو اثر مطلوبی نداشته باشد.
وقتی که یک ویو را فلت می زنیم(با کاستوم‌ویو مثل رو‌های لیست‌ویو تلگرام)، یعنی کاستوم‌ویو آن را می‌نویسیم، به پرفورمنس بهتری دست پیدا خواهیم کرد، چرا که هر با سایز همه زیرلایه‌های آن ویو حساب نمی‌شود(مثال در لیست‌ویو).



ساخت کاستوم‌ویو
---
زمانی که بخواهیم یک کاستوم‌ویو بسازیم، باید کلاسمان را از کلاس View اندروید اکستند کنیم.
در این حالت هم می‌توانیم از ویو‌های آماده اندروید(مثل TextView) استفاده کنیم و هم می توانیم از Canvas برای رسم ویو دلخواه خودمان استفاده کنیم.


زمانی که می‌خواهیم یک کاستوم‌ویو بسازیم، باید حتما دو کانستراکتور زیر را ایمپلمنت کنیم. کانستراکتور اول برای زمانی استفاده می‌شود که ویو را از داخل کلا جاوا بسازیم و کانستراکتور دوم زمانی استفاده می‌شود که از ویو را از داخل xml بسازیم.

اگر هر یک از کانستراکتور‌ها را ایمپلمنت نکنیم، هنگام استفاده از آن اپ کرش خواهد‌کرد.


لایف‌سایکل یک کاستوم‌ویو همانند شکل زیر است. 
//عکس لاف‌سایکل ویو
![android_view_lifecycle](android_view_lifecycle.png)



کال‌بک onDraw: در این کال‌بک یک نمونه از Canvas  بازگردانده می‌شود که با استفاده از این کلاس و کمک گرفتن از Paint می‌توانیم، هر چیزی را رسم کنیم.



برای رسم شکل توسط Canvas از متد‌های draw این کلاس ایتفاده می کنیم.

Canvas ابزاری برای رسم شکل‌های ماست درحالیکه Paint استایل و ویژگی‌های شکلی که می‌خواهیم رسم شود را تعیین می‌کند، Canvas از روی این ویژگی‌ها شکل را رسم می‌کند.



بررسی برخی از فانکشن‌های Canvas:

drawLine:
 با این فانکشن می‌توانیم خط مستقیم رسم کنیم. که مختصات نقطه شروع و پایان و Paint  مربوط را گرفته و از روی آن خط را رسم می‌کند.

drawCircle: 
با استفاده از این متد دایره می‌کشیم. که مختصات نقطه مرکز، شعاع دایره و Paint را گرفته و رسم می‌کند.


انواع Style ها در  Paint: 
سه نوع استایل در پینت وجود دارد: ۱-استروک که فقط استروک می‌کشد. ۲-فیل که فقط وسط شکل را می‌کشد و ۳-استروک‌اندفیل که هم وسط و هم استروک را می‌کشد.



drawRect: 
متدی است که یک rect و یک paint می گیرد و آن را رسم می‌کند. رکت هم آبجکتی است که دو نقطه مختصات شروع و پایان مستطیل را می‌گیرد.


drawArc:
با این متد می‌توانیم نیم‌دایره و یا قسمتی از دایره را رسم کنیم.
این متد یک رکت می‌گیرد و یک startAngel که زاویه شروع رسم است و sweepAngel هم مقدار زاویه‌ای است که می‌خواهیم شکل ادامه پیدا کند و بعد از آن useCenter است که بولینی است که مشخص می‌کند آیا از شکل به مرکز آن خط رسم‌ شود یا خیر. و در انتها هم پینت را می‌گیرد.

drawText:
این متد با گرفتن استرینگ تکست و مختصات رسم و پینت، متنی را برای ما رسم می‌کند.

نکته: با استفاده از مقدار بازگشتی متد getTextBoundsای که در paint وجود دارد، می‌توانیم بفهمیم که متنی که رسم می‌کنیم، چه مختصاتی از صفحه را می‌گیرد. خود این تابع خروجی‌ای ندارد بلکه مقادیر را روی rectای که در آخر به آن می‌دهیم ست می‌کند.


drawBitmap: با استفاده از این متد می‌توانیم بیت‌مپ رسم کنیم، این متد ابتدا بیت‌مپی که می‌خواهیم رسم کنیم را می‌گیرد و سپس srcRect که قسمتی از بیت‌مپی است که می‌خواهیم رسم شود و destRect مکانی که می‌خوواهیم بیت‌مپ رسم شود

   

drawPath: متدی است که با آن می‌توانیم هر شکل کاستومی را بکشیم. ین متد یک path و یک paint می‌گیرد.
می‌توانیم برای هر path یک pathEffect داشته باشیم و پث موردنظر را با PathEffect دلخواه رسم کنیم.  در حالت عادی pathما با NormalPathEffect رسم می‌شود. 

PathEffect های دیگری که هستند:
CornetPathEffect  که گوشه‌های path را کِرو(منحنی) می‌کند.
DashPathEffect که path موردنظر را خط‌جین خط‌چین رسم می‌کند.
DiscretePathEffect که خط را به صورت موجی رسم می‌کند.
  ComposePathEffect  که با آن می‌توانیم چند pathEffect را ترکیب کنیم.


Shaderها: انواع مختلفی دارد و با استفاده از آن‌ها می‌توانیم به جای رنگ ثابت از یک بازه‌ای از رنگ‌ها برای رنگ‌امیزی یک canvas  استفاده کنیم.

LinearShader
BitmapShader
 



بعد از متد onDraw نوبت به کال‌بک onMeasure  می‌رسد که در آن سایز ویو ما مشخص می‌شود. در این قسمت باید به اندروید بگوییم که چقدر فضا برای ویومان می‌خواهیم.
این متد دو مقدار widthMeasureSpec و heightMeasureSpec را باز می‌گرداند. که هرکدام از این دو متغیر دو مقدار را داخل خود نگه‌می‌دارد.  یکی از آن‌ها Mode است و دیگری size.

برای گرفتن mode و size از متد MeasureSpec.getMode و MeasureSpec.getSize استفاده می‌کنیم.

مد سه حالت دارد: UNSPECIFIED, EXACTLY, AT_MOST
و سایز مقدار واقعی به پیکسل است.

UNSPECIFIED: wrap_content

EXACTLY: 24dp

AT_MOST: match_parent

بعد از آنکه با این دو متغیر طول و عرض ویو را بدست آوردیم، در انتهای onMeasure متد setMeasureDimension را صدازده و طول و عرض محاسبه شده را به آن پاس می‌دهیم.

استروک‌ها،پدینگ‌ها و ... باید در کاستوم‌ویو هندل شود و باید خودمان آن را بنویسیم.

اگر بخواهیم در xml اتریبیوت‌های کاستوم داشته‌باشیم، باید در res/values/attrs.xml اتریبیوت‌های خود را اضافه کنیم و بعدا از آن‌ها استفاده کنیم.


invalidate() را زمانی صدا می‌زنیم که فقط تغییر گرافیکی داشته‌باشیم.

اما requestLayout() را زمانی صدا می‌زنیم که می‌دانیم سایز ویو تغییر کرده است.


برای استفاده از انیمیشن در ویوها باید فریم به فریم آن را انجام دهیم، اما با استفاده از valueAnimator این کار بسیار ساده‌تر می‌شود. این کلاس یک تغییر و یک زمان تغییر می‌گیرد و انیمیشن را در این بازه اجرا خواهد کرد.

 برای هندل‌کردن تاچ‌ها onTouchEvent() را ایمپلمنت می‌کنیم.
